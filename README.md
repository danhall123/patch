PATCH - final working version with full Firebase-powered client management.